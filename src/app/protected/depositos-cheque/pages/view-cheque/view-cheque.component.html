<!-- components/listar-depositos/listar-depositos.component.html -->

<div class="card">
    <h5>Consulta de Depósitos de Cheque</h5>
    
    <!-- Search Criteria Form -->
    <div class="p-fluid grid formgrid">
        <div class="field col-12 md:col-3">
            <label for="empresa">Empresa</label>
            <p-dropdown id="empresa" 
                        [options]="empresas" 
                        [(ngModel)]="selectedEmpresa" 
                        optionLabel="nombre" 
                        optionValue="codEmpresa"
                        placeholder="Seleccione una Empresa"
                        (onChange)="onEmpresaChange()"></p-dropdown>
        </div>

        <div class="field col-12 md:col-3">
            <label for="banco">Banco</label>
            <p-dropdown id="banco" 
                        [options]="bancos" 
                        [(ngModel)]="selectedBanco" 
                        optionLabel="nombreBanco" 
                        optionValue="idBxC"
                        placeholder="Seleccione un Banco"></p-dropdown>
        </div>
        
        <div class="field col-12 md:col-3">
            <label for="fechaInicio">Desde</label>
            <p-calendar id="fechaInicio" 
                       [(ngModel)]="fechaInicio" 
                       dateFormat="dd/mm/yy" 
                       [showIcon]="true"></p-calendar>
        </div>
        
        <div class="field col-12 md:col-3">
            <label for="fechaFin">Hasta</label>
            <p-calendar id="fechaFin" 
                       [(ngModel)]="fechaFin" 
                       dateFormat="dd/mm/yy" 
                       [showIcon]="true"></p-calendar>
        </div>
        
        <div class="field col-12 md:col-3">
            <label for="cliente">Cliente</label>
            <p-dropdown id="cliente" 
                        [filter]="true"
                        filterBy="nombreCompleto"
                        [showClear]="true"
                        [options]="sociosNegocio" 
                        [(ngModel)]="selectedCliente" 
                        optionLabel="nombreCompleto" 
                        optionValue="codCliente"
                        placeholder="Seleccione un Cliente"></p-dropdown>
        </div>
        
        <div class="field col-12 md:col-9 flex justify-content-end">
            <p-button label="Buscar" icon="pi pi-search" (onClick)="buscar()"></p-button>
        </div>
    </div>
    
    <!-- Results Table -->
    <p-table [value]="depositos" [loading]="loading" styleClass="p-datatable-sm p-datatable-gridlines" 
             [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5,10,25,50]">
        <ng-template pTemplate="header">
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Banco</th>
                <th>Empresa</th>
                <th>Importe</th>
                <th>Moneda</th>
                <th>Estado</th>
                <th>Documentos</th>
                <th>Fechas</th>
                <th>Facturas</th>
                <th>Acciones</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-deposito>
            <tr>
                <td>{{deposito.idDeposito}}</td>
                <td>{{deposito.codCliente}}</td>
                <td>{{deposito.nombreBanco}}</td>
                <td>{{deposito.nombreEmpresa}}</td>
                <td>{{deposito.importe | number:'1.2-2'}}</td>
                <td>{{deposito.moneda}}</td>
                <td>{{deposito.esPendiente}}</td>
                <td>{{deposito.numeroDeDocumentos}}</td>
                <td>{{deposito.fechasDeDepositos}}</td>
                <td>{{deposito.numeroDeFacturas}}</td>
                <td>
                    <button pButton pRipple icon="pi pi-image" 
                            class="p-button-rounded p-button-info p-button-text mr-2" 
                            (click)="descargarImagen(deposito)" 
                            pTooltip="Descargar Imagen"></button>
                    <button pButton pRipple icon="pi pi-file-pdf" 
                            class="p-button-rounded p-button-success p-button-text" 
                            (click)="descargarPdf(deposito)" 
                            pTooltip="Descargar PDF"></button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="11" class="text-center">No se encontraron depósitos.</td>
            </tr>
        </ng-template>
    </p-table>

    <p-toast></p-toast>
</div>